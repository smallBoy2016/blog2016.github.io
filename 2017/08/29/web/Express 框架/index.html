<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!--Description-->
  

  <!--Author-->
  
  <meta name="author" content="Smartboy">
  

  <!--Open Graph Title-->
  
      <meta property="og:title" content="Express 框架"/>
  
  <!--Open Graph Description-->
  
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="Smartboy"/>
  <!--Type page-->
  
      <meta property="og:type" content="article" />
  
  <!--Page Cover-->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Title -->
  
  <title>Express 框架 - Smartboy</title>


  <link rel="shortcut icon" href="https://hexo.io/icon/favicon-96x96.png">

  <!-- Custom CSS/Sass -->
  <link rel="stylesheet" href="/css/style.css">

  <!----------------------------
  https://github.com/GallenHu/hexo-theme-Daily

 _____            _   _
|  __ \          (_) | |
| |  | |   __ _   _  | |  _   _
| |  | |  / _` | | | | | | | | |
| |__| | | (_| | | | | | | |_| |
|_____/   \__,_| |_| |_|  \__, |
                          __/ |
                         |___/

    --------------------------->

</head>


<body>

  <!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="https://hexo.io/logo.svg" alt="Smartboy" height="60">
        
      </a>
    </div>
    <!-- Navigation -->
    <nav class="navbar">
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  Home
                
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  Archive
                
              </a>
            </li>
          
            <li>
              <a href="/demo">
                
                  Demo
                
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
  <div class="post">
    <!-- Post Content -->
    <div class="container">
      <article>
        <!-- Title date & tags -->
        <div class="post-header">
          <h1 class="entry-title">
            Express 框架
            
          </h1>
          <p class="posted-on">
          2017-08-29
          </p>
          <div class="tags-links">
            
              
                <a href="/tags/Web开发/" rel="tag">
                  Web开发
                </a>
              
            
          </div>
        </div>
        <!-- Post Main Content -->
        <div class="entry-content">
          <h1 id="Express-框架"><a href="#Express-框架" class="headerlink" title="Express 框架"></a>Express 框架</h1><p>[toc]</p>
<p>Express框架是后台的Node框架，所以和jQuery、zepto、yui、bootstrap都不一个东西。</p>
<p>Express在后台的受欢迎的程度，和jQuery一样，就是企业的事实上的标准。</p>
<p><strong>原生Node开发，会发现有很多问题。</strong>比如：</p>
<ul>
<li>呈递静态页面很不方便，需要处理每个HTTP请求，还要考虑304问题</li>
<li>路由处理代码不直观清晰，需要写很多正则表达式和字符串函数</li>
<li>不能集中精力写业务，要考虑很多其他的东西</li>
</ul>
<p>EXPRESS的哲学是在你的想法和服务器之间充当薄薄的一层。这并不意味着他不够健壮，或者没有足够的有用特性，而是尽量少干预你，让你充分表达自己的思想，同时提供一些有用的东西。</p>
<p>安装Express框架，就是使用npm的命令。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save express</div></pre></td></tr></table></figure></p>
<p>–save参数，表示自动修改package.json文件，自动添加依赖项。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm init</div></pre></td></tr></table></figure>
<p>生成package.json文件</p>
<h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><h3 id="一个简单的路由"><a href="#一个简单的路由" class="headerlink" title="一个简单的路由"></a>一个简单的路由</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//在node_moudules里引入express模块</span></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"></div><div class="line">app.get(<span class="string">"/"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">  res.send(<span class="string">"你好！"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.get(<span class="string">"/haha"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">  res.send(<span class="string">"这是haha页面"</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<p>当用get请求访问一个网址的时候，做什么事情：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">"网址"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">	</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>当用post访问一个网址的时候，做什么事情：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.post(<span class="string">"网址"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">	</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>如果想处理这个网址的任何method的请求，那么写all<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.all(<span class="string">"/"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这里的网址，不分大小写，也就是说，你路由是<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">"/AAb"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    res.send(<span class="string">"你好"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>实际上小写的访问也行。</p>
<p>所有的GET参数，? 后面的都已经被忽略。 锚点#也被忽略<br>你路由到/a ， 实际/a?id=2&amp;sex=nan 也能被处理。</p>
<p>正则表达式可以被使用。正则表达式中，未知部分用圆括号分组，然后可以用req.params[0]、[1]得到。<br>req.params类数组对象。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="regexp">/^\/student\/([\d]&#123;10&#125;)$/</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    res.send(<span class="string">"学生信息，学号"</span> + req.params[<span class="number">0</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>冒号是更推荐的写法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">"/student/:id"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> id = req.params[<span class="string">"id"</span>];</div><div class="line">    <span class="keyword">var</span> reg= <span class="regexp">/^[\d]&#123;6&#125;$/</span>;   <span class="comment">//正则验证</span></div><div class="line">    <span class="keyword">if</span>(reg.test(id))&#123;</div><div class="line">        res.send(id);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        res.send(<span class="string">"请检查格式"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="静态文件伺服能力"><a href="#静态文件伺服能力" class="headerlink" title="静态文件伺服能力"></a>静态文件伺服能力</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"></div><div class="line">app.use(express.static(<span class="string">"./public"</span>));</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p>js部分<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"><span class="comment">//设置模板引擎</span></div><div class="line">app.set(<span class="string">"view engine"</span>,<span class="string">"ejs"</span>);</div><div class="line"></div><div class="line">app.get(<span class="string">"/"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">  res.render(<span class="string">"haha"</span>,&#123;</div><div class="line">    <span class="string">"news"</span>:[<span class="string">"新闻1"</span>,<span class="string">"新闻2"</span>,<span class="string">"新闻3"</span>]</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure></p>
<p>haha.ejs模板<br><figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;ul&gt;</div><div class="line">  &lt;% for(var i=0 ; i&lt; news.length ; i++)&#123; %&gt;</div><div class="line">    &lt;li&gt;&lt;% news[i] %&gt;&lt;/li&gt;</div><div class="line">  &lt;% &#125; %&gt;</div><div class="line">&lt;/ul&gt;</div></pre></td></tr></table></figure></p>
<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><p>如果我的的get、post回调函数中，没有next参数，那么就匹配上第一个路由，就不会往下匹配了。<br>如果想往下匹配的话，那么需要写next()<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">"/"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"1"</span>);</div><div class="line">    next();</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.get(<span class="string">"/"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"2"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>下面两个路由，感觉没有关系：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">app.get(<span class="string">"/:username/:id"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"1"</span>);</div><div class="line">    res.send(<span class="string">"用户信息"</span> + req.params.username);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.get(<span class="string">"/admin/login"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"2"</span>);</div><div class="line">    res.send(<span class="string">"管理员登录"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>但是实际上冲突了，因为admin可以当做用户名 login可以当做id。</p>
<p><strong>解决方法1：</strong>交换位置。 也就是说，express中所有的路由（中间件）的顺序至关重要。<br>匹配上第一个，就不会往下匹配了。 具体的往上写，抽象的往下写。</p>
<p><strong>解决方法2：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">app.get(&quot;/:username/:id&quot;,function(req,res,next)&#123;</div><div class="line">    var username = req.params.username;</div><div class="line">    //检索数据库，如果username不存在，那么next()</div><div class="line">    if(检索数据库)&#123;</div><div class="line">        console.log(&quot;1&quot;);</div><div class="line">        res.send(&quot;用户信息&quot;);</div><div class="line">    &#125;else&#123;</div><div class="line">        next();</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.get(&quot;/admin/login&quot;,function(req,res)&#123;</div><div class="line">    console.log(&quot;2&quot;);</div><div class="line">    res.send(&quot;管理员登录&quot;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>路由get、post这些东西，就是中间件，中间件讲究顺序，匹配上第一个之后，就不会往后匹配了。next函数才能够继续往后匹配。</p>
<p>app.use()也是一个中间件。与get、post不同的是，他的网址不是精确匹配的。而是能够有小文件夹拓展的。<br>比如网址：  <a href="http://127.0.0.1:3000/admin/aa/bb/cc/dd" target="_blank" rel="external">http://127.0.0.1:3000/admin/aa/bb/cc/dd</a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="string">"/admin"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123; </div><div class="line">    res.write(req.originalUrl + <span class="string">"\n"</span>);   <span class="comment">//    /admin/aa/bb/cc/dd</span></div><div class="line">    res.write(req.baseUrl + <span class="string">"\n"</span>);  <span class="comment">//   /admin</span></div><div class="line">    res.write(req.path + <span class="string">"\n"</span>);   <span class="comment">//    /aa/bb/cc/dd</span></div><div class="line">    res.end(<span class="string">"你好"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>如果写一个/<br>//当你不写路径的时候，实际上就相当于”/“，就是所有网址<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>());</div><div class="line">    next();</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>app.use()就给了我们增加一些特定功能的便利场所。<br>实际上app.use()的东西，基本上都从第三方能得到。</p>
<h2 id="GET请求和POST请求的参数"><a href="#GET请求和POST请求的参数" class="headerlink" title="GET请求和POST请求的参数"></a>GET请求和POST请求的参数</h2><p>GET请求的参数在URL中，在原生Node中，需要使用url模块来识别参数字符串。在Express中，不需要使用url模块了。可以直接使用req.query对象。</p>
<p>POST请求在express中不能直接获得，必须使用body-parser模块。使用后，将可以用req.body得到参数。但是如果表单中含有文件上传，那么还是需要使用formidable模块。</p>
<p>Node中全是回调函数，所以我们自己封装的函数，里面如果有异步的方法，比如I/O，那么就要用回调函数的方法封装。</p>
<p>错误：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">res.reder(<span class="string">"index"</span>,&#123;</div><div class="line">	<span class="string">"name"</span> : student.getDetailById(<span class="number">234234</span>).name</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>正确:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">student.getDetailByXueHao(<span class="number">234234</span>,<span class="function"><span class="keyword">function</span>(<span class="params">detail</span>)</span>&#123;</div><div class="line">	res.render(<span class="string">"index"</span>,&#123;</div><div class="line">		<span class="string">"name"</span> : detail.name</div><div class="line">	&#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>

        </div>
      </article>
    </div>
    <!-- Comments -->
    <div class="container">
      
<section id="comment">
  <!-- <h1 class="title">留言</h1> -->

  
</section>


    </div>
    <!-- Pre or Next -->
    <div class="nav-links">
      
      
        <div class="nav-next">
          <a href="/2017/07/03/web/移动端布局/" rel="prev">下一页 <span class="meta-arraw meta-arraw-right"></span></a>
        </div>
      
    </div>

  </div>
</div>


  <!-- Footer -->
  <!-- Footer-widgets -->
<div class="footer-widgets">
  <div class="row inside-wrapper">
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">关于本站</h1>
        <div class="custom-widget-content">
          
          <ul></ul>
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">与我联系</h1>
        <div class="widget-text">
          
            
              <a href="mailto:f224031@126.com" class="icon icon-mail" target="_blank">mail</a>
            
          
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">站内搜索</h1>
        <div class="widget-text">
          <form onSubmit="return appDaily.submitSearch('')">
            <p>
              <input type="text" placeholder="search..." id="homeSearchInput">
            </p>
            <!-- <input type="submit" value="GO"> -->
          </form>
        </div>
      </aside>
    </div>
  </div>
</div>
<!-- Footer -->
<footer class="site-info">
  <p>
    <span>Smartboy &copy; 2017</span>
    
      <span class="split">|</span>
      <span></span>
    
  </p>
</footer>


  <!-- After footer scripts -->
  <!-- scripts -->
<script src="/js/app.js"></script>



</body>

</html>